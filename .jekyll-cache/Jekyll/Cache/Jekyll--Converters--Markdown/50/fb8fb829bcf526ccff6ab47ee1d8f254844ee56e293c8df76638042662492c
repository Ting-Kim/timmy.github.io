I"8(<h1 id="ubuntu-í™˜ê²½ì—ì„œ-uwsgi-nginxë¥¼-ì‚¬ìš©í•´ì„œ-django-í”„ë¡œì íŠ¸-ë°°í¬í•˜ê¸°">Ubuntu í™˜ê²½ì—ì„œ uWSGI, Nginxë¥¼ ì‚¬ìš©í•´ì„œ Django í”„ë¡œì íŠ¸ ë°°í¬í•˜ê¸°</h1>

<p><strong>Wsgi</strong>, ì›¹ ì„œë²„ ê²Œì´íŠ¸ì›¨ì´ ì¸í„°í˜ì´ìŠ¤) (íŒŒì´ì¬ì—ì„œëŠ” Uwsgië¼ê³  í•¨)</p>

<ul>
  <li>ì†Œì¼“ì´ ìë™ ìƒì„±ë˜ëŠ”ë°, ìš”ì²­ì´ ë“¤ì–´ì™”ì„ ë•Œ ìë™ìœ¼ë¡œ ì—°ê²°í•´ì£¼ëŠ” ì—­í• (?)</li>
  <li>Nginx ì™€ ì—°ê²°ë‹¤ë¦¬ ì—­í• (?)</li>
</ul>

<p>ì´ <a href="https://www.youtube.com/watch?v=oGQ1HteFYnQ">ìœ íŠœë¸Œ ì˜ìƒ</a>ì„ ì°¸ê³ í•˜ì˜€ë‹¤ê°€ ë¯¸ì¹œë“¯í•œ ì—ëŸ¬ë“¤ì„ ê²ªì—ˆë‹¤.</p>

<p><strong>ì—ëŸ¬ë¬¸êµ¬</strong></p>

<p><code class="language-plaintext highlighter-rouge">2020/12/31 18:15:12 [error] 5214#5214: *1 upstream prematurely closed connection while reading response header from upstream, client: 221.151.46.236, server: _, request: "GET /favicon.ico HTTP/1.1", upstream: "uwsgi://unix:/home/ubuntu/django-eda/myeda/uwsgi.sock:", host: "52.78.60.138", referrer: "[http://52.78.60.138/](http://52.78.60.138/)" "error.log" [readonly] 42L, 11592C</code></p>

<p><img src="https://github.com/Ting-Kim/Ting-kim.github.io/blob/main/images/20210103_2.png?raw=true" alt="https://github.com/Ting-Kim/Ting-kim.github.io/blob/main/images/20210103_2.png?raw=true" /></p>

<p>ì´ê±´ ì–´ë–»ê²Œ í•´ê²°í–ˆëŠ”ì§€ ê¸°ì–µë„ ì•ˆ ë‚˜ë„¤.. ğŸ˜±</p>

<p><br /></p>

<hr />

<h2 id="ìƒˆë¡œìš´-ë§ˆìŒìœ¼ë¡œ-ì²˜ìŒë¶€í„°-ë‹¤ì‹œ-ì‹œë„">ìƒˆë¡œìš´ ë§ˆìŒìœ¼ë¡œ <strong>ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì‹œë„..!</strong></h2>

<p>ëŠë‚Œì´ ì¢‹ì€ ê³³ì„ ì°¾ì•„ì„œ ì´ë²ˆì—” ì´ <a href="https://yuddomack.tistory.com/entry/ì²˜ìŒë¶€í„°-ì‹œì‘í•˜ëŠ”-EC2-python-ì„¤ì¹˜?category=777812">í¬ìŠ¤íŒ…</a>ì„ ì°¸ê³ í•˜ì˜€ë‹¤.</p>

<p><br /></p>

<p><strong>ê²ªì—ˆë˜ ì—ëŸ¬</strong></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">uwsgi: error while loading shared libraries: libpcre.so.1: cannot open shared object file: No such file or directory</code> - <a href="https://stackoverflow.com/questions/43301339/pcre-issue-when-setting-up-wsgi-application/50087846">https://stackoverflow.com/questions/43301339/pcre-issue-when-setting-up-wsgi-application/50087846</a> , <a href="https://github.com/unbit/uwsgi/issues/1770">https://github.com/unbit/uwsgi/issues/1770</a></li>
  <li><code class="language-plaintext highlighter-rouge">!!! Python Home is not a directory: ../myvenv/ !!! Set PythonHome to ../myvenv/ Fatal Python error: initfsencoding: Unable to get the locale encoding ModuleNotFoundError: No module named 'encodings' Current thread 0x00007f2a61551740 (most recent call first): Aborted (core dumped)</code> - ê°€ìƒí™˜ê²½ ê²½ë¡œ ì„¤ì • ë¬¸ì œì˜€ë‹¤ (<a href="https://stackoverflow.com/questions/60809917/django-w-uwsgi-fatal-python-error-initfsencoding-unable-to-get-the-locale-enc">https://stackoverflow.com/questions/60809917/django-w-uwsgi-fatal-python-error-initfsencoding-unable-to-get-the-locale-enc</a>)</li>
</ul>

<p><br /></p>

<p>uWSGI <strong>ê³µì‹ ë¬¸ì„œ</strong></p>

<ul>
  <li><a href="https://uwsgi-docs.readthedocs.io/en/latest/WSGIquickstart.html">https://uwsgi-docs.readthedocs.io/en/latest/WSGIquickstart.html</a></li>
</ul>

<p><br /></p>

<h3 id="ì—ëŸ¬-í•´ê²°-ë‚´ìš©ë§í¬-í¬í•¨">ì—ëŸ¬ í•´ê²° ë‚´ìš©(ë§í¬ í¬í•¨)</h3>

<ul>
  <li>
    <p><a href="https://stackoverflow.com/questions/20531131/uwsgi-runs-wrong-version-of-python">ê·¼ë³¸ì ì¸ python, pip ë²„ì „ì— ëŒ€í•œ ì§€ì  (â€˜uWSGI runs wrong version of Pythonâ€™ - StackOverFlow)</a></p>

    <p>â‡’ ëŒ€ë¶€ë¶„ì˜ íŒ¨í‚¤ì§€ë“¤ì´ pipë¥¼ í†µí•´ ì„¤ì¹˜ë˜ëŠ”ë°, pipëŠ” í™˜ê²½ì— defaultë¡œ ì„¤ì •ëœ pythonì„ ê¸°ë°˜ìœ¼ë¡œ íƒ‘ì¬ ë˜ì–´ìˆë‹¤. uwsgië„ pipë¥¼ í†µí•´ ì„¤ì¹˜í•˜ê¸° ë•Œë¬¸ì—, uwsgiëŠ” ì„¤ì¹˜ë  ë•Œì˜ pipì— í•´ë‹¹í•˜ëŠ” python ë²„ì „ì— ì˜ì¡´í•œë‹¤. ê·¸ë˜ì„œ ìš°ë¶„íˆ¬ í™˜ê²½ì—ì„œ uwsgië¥¼ ë¹„ë¡¯í•œ íŒ¨í‚¤ì§€ë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” <strong>ì´ˆê¸° ì ‘ì†í•˜ìë§ˆì python, pip ë“±ì˜ ê·¼ë³¸ì ì¸ ë²„ì „ ì„¤ì •(default í¬í•¨)í•˜ëŠ” ê²ƒ</strong>ì´ ì¤‘ìš”í•˜ë‹¤. AWS_EC2ì˜ ê²½ìš° ê¸°ë³¸ì ìœ¼ë¡œ <code class="language-plaintext highlighter-rouge">/home/ubuntu/anaconda3/bin/python</code> ì— ë””í´íŠ¸ë¡œ ì„¤ì •ë˜ì–´ ìˆìœ¼ë¯€ë¡œ ì´ê±¸ <code class="language-plaintext highlighter-rouge">/usr/bin/local/python</code> ë¡œ ì„¤ì •ì„ ë³€ê²½í•˜ëŠ”ê²Œ ì¤‘ìš”í•˜ë‹¤. ë³€ê²½í•˜ëŠ” ë°©ë²•ì€ <a href="https://www.notion.so/AWS-EC2-python-pip-default-80be1f872e544d91b0d2ca383d74e714">ì—¬ê¸°</a>ë¥¼ ì°¸ê³ í•˜ì.</p>
  </li>
  <li><code class="language-plaintext highlighter-rouge">"Could not install packages due to an EnvironmentError: [Errno 13] Permission denied: '/usr/lib/libraryName' Consider using the '--user' option or check the permissions."</code> : <code class="language-plaintext highlighter-rouge">python3 -m pip install -user "package name"</code> ë¡œ í•´ê²°</li>
  <li>ì„¤ì¹˜ ì‹œ <code class="language-plaintext highlighter-rouge">"libpcre.so.1 not found"</code> : ì„¤ì¹˜ ëª…ë ¹ì–´ì— <code class="language-plaintext highlighter-rouge">sudo</code> ë¶™ì—¬ì„œ í•´ê²°</li>
  <li><a href="https://stackoverflow.com/questions/42973991/djangoapache-modulenotfounderror-no-module-named-myproject/47256068#comment93487493_42981216">uwsgi ì‹¤í–‰ ì‹œ wsgi.pyë¥¼ ëª»ì°¾ëŠ” ì—ëŸ¬ (â€œDjango+Apache ModuleNotFoundError: No module named â€˜wsgi.pyâ€™â€)</a>
â‡’ <code class="language-plaintext highlighter-rouge">[settings.py](http://settings.py)</code>ì— wsgi.pyì˜ ê²½ë¡œë¥¼ sys.pathì— ì¶”ê°€í•˜ëŠ” ì½”ë“œ ì¶”ê°€í•´ì„œ í•´ê²°í•œë‹¤.</li>
  <li><a href="https://stackoverflow.com/questions/6468397/how-to-check-django-version">django ë²„ì „ í™•ì¸ ë°©ë²•</a> : python ì‹¤í–‰ í›„ <code class="language-plaintext highlighter-rouge">import django</code>, <code class="language-plaintext highlighter-rouge">django.VERSION</code> ì…ë ¥</li>
  <li><a href="https://my-repo.tistory.com/24">í”„ë¡œì íŠ¸ ë‚´ì—ì„œ ì‚¬ìš©í•˜ëŠ” static íŒŒì¼ë“¤ì„ íŠ¹ì • ë””ë ‰í† ë¦¬ë¡œ ëª¨ìœ¼ëŠ” ë°©ë²•</a>
â‡’ Nginxì—ì„œ ì°¸ì¡°í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ì„¤ì •í•  í•„ìš”ê°€ ìˆë‹¤. í”„ë¡œì íŠ¸ì˜ settings.py ì— ì½”ë“œ ë³€ê²½ì„ í•´ì¤˜ì•¼í•  ë¶€ë¶„ì´ ìˆë‹¤. ì•„ë˜ì™€ ê°™ì€ í˜•ì‹ìœ¼ë¡œ ë°”ê¿”ì£¼ë©´ ëœë‹¤. <code class="language-plaintext highlighter-rouge">STATIC_DIR</code>ì€ BASE_DIR(í”„ë¡œì íŠ¸ì˜ manage.py ë£¨íŠ¸)ì— ìƒê¸°ê²Œ ë  static íŒŒì¼ì„ ëª¨ì€ ë””ë ‰í† ë¦¬ë¥¼ ì„¤ì •í•  ì´ë¦„ì´ë‹¤. ìˆ˜ì • í›„ python ì½˜ì†”ì—ì„œ <code class="language-plaintext highlighter-rouge">python manage.py collectstatic</code> ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ë©´ ëœë‹¤.</li>
  <li><a href="https://stackoverflow.com/questions/22071681/permission-denied-nginx-and-uwsgi-socket"><strong>Nginx, uWSGI ì‚¬ìš© ì‹œ Permission denied ì—ëŸ¬ (ê°€ì¥ í•´ê²°ì— í° ë„ì›€ì´ ëœ ë‹µë³€)</strong></a></li>
</ul>

<p><br /></p>

<p><strong>Ubuntu ëª…ë ¹ì–´</strong></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">pkill -f uwsgi -9</code></li>
  <li><code class="language-plaintext highlighter-rouge">ln -s /etc/nginx/sites-available/firstproject /etc/nginx/sites-enabled/</code></li>
  <li><code class="language-plaintext highlighter-rouge">apt-get install &lt;package name&gt;</code></li>
  <li><code class="language-plaintext highlighter-rouge">cp &lt;fileName&gt; &lt;to_directory&gt;</code> : íŒŒì¼ì„ ëª©í‘œ ë””ë ‰í† ë¦¬ì— ë³µì‚¬ (ì´ë™ì€ cp ëŒ€ì‹  mv)</li>
  <li>
    <p>ìœˆë„ìš°ì—ì„œ ë¦¬ëˆ…ìŠ¤ ì„œë²„ë¡œ íŒŒì¼ì„ ì—…ë¡œë“œ ì‹œí‚¤ëŠ” ë°©ë²•ì€ ì´ ë§í¬ë¥¼ ì°¸ê³ í•˜ë©´ ëœë‹¤.
<a href="https://whitewing4139.tistory.com/105">20. Linux - ìœˆë„ìš°ì™€ ë¦¬ëˆ…ìŠ¤ ì‚¬ì´ íŒŒì¼ ì´ë™ ì‹œí‚¤ê¸°(SCP, SFTP)</a></p>
  </li>
  <li><code class="language-plaintext highlighter-rouge">sudo systemctl start uwsgi</code> : ini íŒŒì¼ë“¤ê³¼ í•¨ê»˜ uwsgi ê°€ë™</li>
  <li><code class="language-plaintext highlighter-rouge">sudo systemctl enable uwsgi</code> : uwsgië¥¼ serviceì— ë“±ë¡</li>
  <li><code class="language-plaintext highlighter-rouge">service uwsgi status</code></li>
  <li><code class="language-plaintext highlighter-rouge">service nginx start</code></li>
</ul>

<p><br /></p>

<h3 id="uwsgi--nginx-ì´ìš©í•´ì„œ-django-í”„ë¡œì íŠ¸-ë°°í¬-ì„±ê³µ">uWSGI &amp; Nginx ì´ìš©í•´ì„œ Django í”„ë¡œì íŠ¸ ë°°í¬ ì„±ê³µ</h3>

<p>but.. í´ë¦­ ëª‡ë²ˆì— âš <strong>504 Gateway timeout</strong> ë°œìƒ</p>

<p>ê´€ë ¨í•˜ì—¬ ì°¸ê³ í•œ ë§í¬ëŠ” ì—¬ê¸°ë‹ˆê¹Œ ìì„¸í•œ ë‚´ìš©ì€ <a href="https://blog.lael.be/post/9251">ì—¬ê¸°</a>ì„œ ê³µë¶€í•©ì‹œë‹¤!</p>

<p><strong>Gateway</strong></p>

<p>â‡’ ì„œë¡œ ë‹¤ë¥¸ ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì‹œ ì¶œì…êµ¬ ì—­í• </p>

<p>ê²°êµ­ <strong>504 Gateway timeout</strong>ì€ Nginxì—ì„œ upstreamê³¼ì˜ í†µì‹  ì§€ì—°ê³¼ ê´€ë ¨í•´ì„œ ì„¤ì •í•œ ì‹œê°„ ì œí•œì„ ë„˜ê¸°ë©´ ë°œìƒí•˜ëŠ” ê²ƒì´ë‹¤.</p>

<p>Gateway timeoutì˜ ì¢…ë¥˜ëŠ” 3ê°€ì§€ë¼ê³  í•œë‹¤.</p>

<ul>
  <li>connect_timeout : <strong>upstream ì—°ê²° ì§€ì—° ì‹œ ë°œìƒ</strong></li>
  <li>send_timeout : í”„ë¡ì‹œ ì—°ê²° í›„ <strong>ë°ì´í„° ì „ì†¡ ì§€ì—° ì‹œ ë°œìƒ</strong> (ex. ì‚¬ìš©ì íŒŒì¼ ì—…ë¡œë“œ ì†ë„ê°€ ë§¤ìš° ëŠë¦¼)</li>
  <li>read_timeout : ëŒ€ë¶€ë¶„ì˜ ì›ì¸ì´ë‹¤. ì‘ë‹µ ìš”ì²­ì´ ì •ìƒì ì´ì§€ë§Œ <strong>ì‘ë‹µ ì§€ì—° ì‹œ ë°œìƒ</strong>
ìš”ì²­(request)ì€ ì „ì†¡ëœ ìƒíƒœë¼ upstreamê³¼ì˜ ì—°ê²°ì„ ê°•ì œë¡œ ëŠì–´ë„ í”„ë¡œì„¸ìŠ¤ëŠ” ê³„ì† ë™ì‘í•œë‹¤. (ê·¸ë˜ì„œ í„°ë¯¸ë„ë„ ë©ˆì¶”ê³  AWS ì¸ìŠ¤í„´ìŠ¤ ì¤‘ì§€ë„ ì—„ì²­ ì˜¤ë˜ ê±¸ë ¸ì—ˆë‹¤..)</li>
</ul>

<p><strong>í•´ê²°ë°©ë²•</strong></p>

<p>â‡’ í”„ë¡ì‹œ ì„¤ì •, celery ë“± ë„ˆë¬´ ì–´ë ¤ì›Œì„œ ì¼ë‹¨ <a href="https://stackoverflow.com/questions/32816975/504-gateway-time-out-uwsgi-nginx-django-application">ì‹œê°„ ì œí•œì„ í™•ì¥ì‹œí‚¤ëŠ” ë°©ë²•</a>ìœ¼ë¡œ í•´ê²°í–ˆë‹¤.</p>

<ul>
  <li>Proxy_pass</li>
  <li>uWSGI_pass</li>
  <li>ë‚´ë¶€ ì²˜ë¦¬ ì‹œê°„ì´ ê¸´ ê²½ìš° celeryë¥¼ ì‚¬ìš©í•˜ë¼ëŠ” ë‹µë³€ë„ ìˆì—ˆë‹¤.</li>
</ul>

<p><br /></p>

<hr />

<p>ì°¸ê³ )</p>

<ul>
  <li><a href="https://kitle.xyz/post/58/">Django Admin(ê´€ë¦¬ì) ê³„ì • ì°¾ê¸° ë° ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</a></li>
  <li><a href="https://ohdowon064.tistory.com/316">Django í…Œì´ë¸” ì´ˆê¸°í™”(í…Œì´ë¸” ë°ì´í„° ëª¨ë‘ ì‚­ì œ)</a></li>
  <li><a href="https://kamang-it.tistory.com/entry/WebServernginxë¡œê·¸ë“¤-ë³´ê¸°">[WebServer][nginx]ë¡œê·¸ ë³´ê³  ìˆ˜ì •í•˜ê¸°-(3)</a></li>
  <li><a href="https://cjh5414.github.io/how-to-deploy-django-uwsgi-nginx-in-ubuntu/">https://cjh5414.github.io/how-to-deploy-django-uwsgi-nginx-in-ubuntu/</a></li>
</ul>
:ET